# PRD: 계획 대비 성취도 분석 (Plan vs. Actual)

## 1. 개요
"계획만 세우고 지키지 않는" 문제를 해결하기 위해, 사용자가 세운 훈련 계획(Plan)과 Strava에서 자동으로 동기화된 실제 기록(Actual)을 매핑하여 이행률을 분석합니다.

## 2. 핵심 로직: 자동 매칭 (Auto Matching)

### 2.1 매칭 알고리즘
- **1단계: 날짜 일치**: 같은 날짜에 발생한 계획과 활동을 찾음.
- **2단계: 유사성 판단**:
    - 계획이 "10km 조깅"이고, 실제 기록이 "9.8km 러닝"이라면 → **Match (성공)**.
    - 계획이 "인터벌"인데, 실제 기록이 "3km 걷기"라면 → **Mismatch (불일치/부분성공)**.
    - 허용 오차(Tolerance)를 두어(예: 거리 ±10%) 유연하게 판단.

### 2.2 성취도 평가 (Compliance Score)
매칭된 쌍에 대해 다음 등급을 부여합니다.
- **Perfect (초록)**: 거리/시간/페이스 목표를 모두 달성.
- **Good (노랑)**: 수행은 했으나 목표치에 조금 미달.
- **Missed (빨강)**: 계획은 있으나 수행 기록이 없음.
- **Unplanned (회색)**: 계획 없이 수행한 추가 훈련.

## 3. 시각화 및 피드백

### 3.1 캘린더 피드백
- 캘린더의 과거 날짜 셀에 성취도 색상(초록/빨강 등)을 표시하여 "내가 얼마나 잘 지켰는지" 직관적으로 보여줌.

### 3.2 주간 리포트
- "이번 주 계획 달성률 80%"와 같은 요약 메시지 제공.
- 계획보다 더 많이 뛰었는지, 덜 뛰었는지 분석하여 다음 주 훈련 강도 조절 제안.

## 4. 기술적 요구사항
- **Edge Function 또는 클라이언트 로직**: 매칭 로직은 데이터가 갱신될 때마다 실행되어야 함.
- **복합 쿼리**: `plans` 테이블과 `activities` 테이블을 조인하여 비교하는 효율적인 쿼리 작성 필요.

## 5. 성공 기준
- 사용자가 별도로 체크하지 않아도, Strava 기록이 들어오면 자동으로 캘린더의 계획이 '완료' 처리되어야 함.
- 오차 범위 내의 기록을 정확하게 매칭해야 함.
